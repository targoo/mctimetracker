var defaults={lazyFetching:true,columnFormat:{resourceDay:"H:mm",},timeFormat:{"":"HH:mm"},theme:false,buttonIcons:{prev:"circle-triangle-w",next:"circle-triangle-e"},unselectAuto:true,days:[{name:"Monday",id:"1"},{name:"Tuesday",id:"2"},{name:"Wednesday",id:"3"},{name:"Thursday",id:"4"},{name:"Friday",id:"5"},{name:"Saturday",id:"6"},{name:"Sunday",id:"7"},]};var fc=$.timetable={version:"@VERSION"};var fcViews=fc.views={};$.fn.timetable=function(c){if(typeof c=="string"){var b=Array.prototype.slice.call(arguments,1);var d;this.each(function(){var f=$.data(this,"timetable");if(f&&$.isFunction(f[c])){var e=f[c].apply(f,b);if(d===undefined){d=e}if(c=="destroy"){$.removeData(this,"timetable")}}});if(d!==undefined){return d}return this}var a=c.eventSources||[];delete c.eventSources;if(c.events){a.push(c.events);delete c.events}c=$.extend(true,{},defaults,c);this.each(function(g,e){var f=$(e);var h=new Calendar(f,c,a);f.data("timetable",h);h.render()});return this};function setDefaults(a){$.extend(true,defaults,a)}function Calendar(q,x,A){var N=this;N.options=x;N.render=E;N.destroy=P;N.refetchEvents=k;N.reportEvents=o;N.reportEventChange=Q;N.rerenderEvents=c;N.changeView=h;N.select=O;N.unselect=j;N.incrementDate=u;N.formatDate=function(W,t){return formatDate(W,t,x)};N.formatDates=function(X,W,t){return formatDates(X,W,t,x)};N.getDate=v;N.getView=B;N.option=K;N.trigger=D;EventManager.call(N,x,A);var a=N.isFetchNeeded;var T=N.fetchEvents;var L=q[0];var d;var F;var m;var V;var l;var U={};var C;var f;var i;var G=0;var M=0;var R=new Date();var z=[];var e;function E(t){if(!m){y()}else{H();S();b();w(t)}}function y(){V=x.theme?"ui":"fc";q.addClass("fc");if(x.theme){q.addClass("ui-widget")}m=$("<div class='fc-content' style='position:relative'/>").prependTo(q);h("resourceDay");$(window).resize(n);if(!p()){g()}}function g(){setTimeout(function(){if(!l.start&&p()){w()}},0)}function P(){$(window).unbind("resize",n);d.destroy();m.remove();q.removeClass("fc fc-rtl ui-widget")}function I(){return L.offsetWidth!==0}function p(){return $("body")[0].offsetWidth!==0}function h(X){if(!l||X!=l.name){M++;j();var W=l;var t;if(W){(W.beforeHide||noop)();setMinHeight(m,m.height());W.element.hide()}else{setMinHeight(m,1)}m.css("overflow","hidden");l=U[X];if(l){l.element.show()}else{l=U[X]=new fcViews[X](t=i=$("<div class='fc-view fc-view-"+X+"' style='position:absolute'/>").appendTo(m),N)}if(W){d.deactivateButton(W.name)}w();m.css("overflow","");if(W){setMinHeight(m,1)}if(!t){(l.afterShow||noop)()}M--}}function w(W){if(I()){M++;j();if(f===undefined){H()}var t=false;if(!l.start||W||R<l.start||R>=l.end){l.render(R,W||0);J(true);t=true}else{if(l.sizeDirty){l.clearEvents();J();t=true}else{if(l.eventsDirty){l.clearEvents();t=true}}}l.sizeDirty=false;l.eventsDirty=false;s(t);C=q.outerWidth();M--;l.trigger("viewDisplay",L)}}function r(){S();if(I()){H();J();j();l.clearEvents();l.renderEvents(z);l.sizeDirty=false}}function S(){$.each(U,function(t,W){W.sizeDirty=true})}function H(){if(x.contentHeight){f=x.contentHeight}else{if(x.height){f=x.height-(F?F.height():0)-vsides(m)}else{f=Math.round(m.width()/Math.max(1,0.5))}}}function J(t){M++;l.setHeight(f,t);if(i){i.css("position","relative");i=null}l.setWidth(m.width(),t);M--}function n(){if(!M){if(l.start){var t=++G;setTimeout(function(){if(t==G&&!M&&I()){if(C!=(C=q.outerWidth())){M++;r();l.trigger("windowResize",L);M--}}},200)}else{g()}}}function s(t){if(!x.lazyFetching||a(l.visStart,l.visEnd)){k()}else{if(t){c()}}}function k(){T(l.visStart,l.visEnd)}function o(t){z=t;c()}function Q(t){c(t)}function c(t){b();if(I()){l.clearEvents();l.renderEvents(z,t);l.eventsDirty=false}}function b(){$.each(U,function(t,W){W.eventsDirty=true})}function O(X,t,W){l.select(X,t,W===undefined?true:W)}function j(){if(l){l.unselect()}}function u(W,t,X){if(W!==undefined){addYears(R,W)}if(t!==undefined){addMonths(R,t)}if(X!==undefined){addDays(R,X)}w()}function v(){return cloneDate(R)}function B(){return l}function K(t,W){if(W===undefined){return x[t]}if(t=="height"||t=="contentHeight"){x[t]=W;r()}}function D(t,W){if(x[t]){return x[t].apply(W||L,Array.prototype.slice.call(arguments,2))}}}fc.sourceNormalizers=[];fc.sourceFetchers=[];var ajaxDefaults={dataType:"json",cache:false};var eventGUID=1;function EventManager(g,p){var r=this;r.isFetchNeeded=j;r.fetchEvents=q;r.addEventSource=d;r.removeEventSource=e;r.updateEvent=v;r.renderEvent=n;r.removeEvents=H;r.clientEvents=B;r.normalizeEvent=m;var u=r.trigger;var a=r.getView;var x=r.reportEvents;var z={events:[]};var b=[z];var E,A;var c=0;var F=0;var D=0;var s=[];for(var C=0;C<p.length;C++){w(p[C])}function j(t,i){return !E||t<E||i>A}function q(L,I){E=L;A=I;s=[];var K=++c;var t=b.length;F=t;for(var J=0;J<t;J++){h(b[J],K)}}function h(t,i){y(t,function(J){if(i==c){if(J){for(var I=0;I<J.length;I++){J[I].source=t;m(J[I])}s=s.concat(J)}F--;if(!F){x(s)}}})}function y(t,P){var L;var O=fc.sourceFetchers;var M;for(L=0;L<O.length;L++){M=O[L](t,E,A,P);if(M===true){return}else{if(typeof M=="object"){y(M,P);return}}}var R=t.events;if(R){if($.isFunction(R)){l();R(cloneDate(E),cloneDate(A),function(i){P(i);G()})}else{if($.isArray(R)){P(R)}else{P()}}}else{var I=t.url;if(I){var Q=t.success;var N=t.error;var J=t.complete;var K=$.extend({},t.data||{});K.start=Math.round(+E/1000);K.end=Math.round(+A/1000);l();$.ajax($.extend({},ajaxDefaults,t,{data:K,success:function(S){S=S||[];var i=applyAll(Q,this,arguments);if($.isArray(i)){S=i}P(S)},error:function(){applyAll(N,this,arguments);P()},complete:function(){applyAll(J,this,arguments);G()}}))}else{P()}}}function d(i){i=w(i);if(i){F++;h(i,c)}}function w(i){if($.isFunction(i)||$.isArray(i)){i={events:i}}else{if(typeof i=="string"){i={url:i}}}if(typeof i=="object"){o(i);b.push(i);return i}}function e(i){b=$.grep(b,function(t){return !k(t,i)});s=$.grep(s,function(t){return !k(t.source,i)});x(s)}function v(M){var K,I=s.length,N,t=a().defaultEventEnd,L=M.start-M._start,J=M.end?(M.end-(M._end||t(M))):0;for(K=0;K<I;K++){N=s[K];if(N._id==M._id&&N!=M){N.start=new Date(+N.start+L);if(M.end){if(N.end){N.end=new Date(+N.end+J)}else{N.end=new Date(+t(N)+J)}}else{N.end=null}N.title=M.title;N.url=M.url;N.allDay=M.allDay;N.className=M.className;N.editable=M.editable;N.color=M.color;N.backgroudColor=M.backgroudColor;N.borderColor=M.borderColor;N.textColor=M.textColor;m(N)}}m(M);x(s)}function n(t,i){m(t);if(!t.source){if(i){z.events.push(t);t.source=z}s.push(t)}x(s)}function H(I){if(!I){s=[];for(var t=0;t<b.length;t++){if($.isArray(b[t].events)){b[t].events=[]}}}else{if(!$.isFunction(I)){var J=I+"";I=function(i){return i._id==J}}s=$.grep(s,I,true);for(var t=0;t<b.length;t++){if($.isArray(b[t].events)){b[t].events=$.grep(b[t].events,I,true)}}}x(s)}function B(i){if($.isFunction(i)){return $.grep(s,i)}else{if(i){i+="";return $.grep(s,function(t){return t._id==i})}}return s}function l(){if(!D++){u("loading",null,true)}}function G(){if(!--D){u("loading",null,false)}}function m(J){start=J.start;end=J.end;var t=new Date();var M=t.getDate();var i=t.getMonth();var N=t.getFullYear();var I=Math.floor(start/60);var L=start-(I*60);J.start=new Date(N,i,M,I,L);console.log(I);console.log(J.start);var I=Math.floor(end/60);var L=end-(I*60);J.end=new Date(N,i,M,I,L);console.log(J.start);var K=J.source||{};J._id=J._id||(J.id===undefined?"_fc"+eventGUID++:J.id+"");if(J.date){if(!J.start){J.start=J.date}delete J.date}J._start=cloneDate(J.start=parseDate(J.start,true));J.end=parseDate(J.end,true);if(J.end&&J.end<=J.start){J.end=null}J._end=J.end?cloneDate(J.end):null;if(J.className){if(typeof J.className=="string"){J.className=J.className.split(/\s+/)}}else{J.className=[]}}function o(J){if(J.className){if(typeof J.className=="string"){J.className=J.className.split(/\s+/)}}else{J.className=[]}var I=fc.sourceNormalizers;for(var t=0;t<I.length;t++){I[t](J)}}function k(t,i){return t&&i&&f(t)==f(i)}function f(i){return((typeof i=="object")?(i.events||i.url):"")||i}}fc.addDays=addDays;fc.cloneDate=cloneDate;fc.parseDate=parseDate;fc.formatDate=formatDate;fc.formatDates=formatDates;var DAY_MS=86400000,HOUR_MS=3600000,MINUTE_MS=60000;function addDays(e,f,c){if(+e){var a=e.getDate()+f,b=cloneDate(e);b.setHours(9);b.setDate(a);e.setDate(a);if(!c){clearTime(e)}fixDate(e,b)}return e}function fixDate(b,a){if(+b){while(b.getDate()!=a.getDate()){b.setTime(+b+(b<a?1:-1)*HOUR_MS)}}}function addMinutes(a,b){a.setMinutes(a.getMinutes()+b);return a}function clearTime(a){a.setHours(0);a.setMinutes(0);a.setSeconds(0);a.setMilliseconds(0);return a}function cloneDate(a,b){if(b){return clearTime(new Date(+a))}return new Date(+a)}function parseDate(b,a){return new Date(b)}function formatDate(b,c,a){return formatDates(b,null,c,a)}function formatDates(o,n,m,p){p=p||defaults;var b=o,e=n,f,g=m.length,j,d,l,h="";for(f=0;f<g;f++){j=m.charAt(f);if(j=="'"){for(d=f+1;d<g;d++){if(m.charAt(d)=="'"){if(b){if(d==f+1){h+="'"}else{h+=m.substring(f+1,d)}f=d}break}}}else{if(j=="("){for(d=f+1;d<g;d++){if(m.charAt(d)==")"){var a=formatDate(b,m.substring(f+1,d),p);if(parseInt(a.replace(/\D/,""),10)){h+=a}f=d;break}}}else{if(j=="["){for(d=f+1;d<g;d++){if(m.charAt(d)=="]"){var k=m.substring(f+1,d);var a=formatDate(b,k,p);if(a!=formatDate(e,k,p)){h+=a}f=d;break}}}else{if(j=="{"){b=n;e=o}else{if(j=="}"){b=o;e=n}else{for(d=g;d>f;d--){if(l=dateFormatters[m.substring(f,d)]){if(b){h+=l(b,p)}f=d-1;break}}if(d==f){if(b){h+=j}}}}}}}}return h}var dateFormatters={s:function(a){return a.getSeconds()},ss:function(a){return zeroPad(a.getSeconds())},m:function(a){return a.getMinutes()},mm:function(a){return zeroPad(a.getMinutes())},h:function(a){return a.getHours()%12||12},hh:function(a){return zeroPad(a.getHours()%12||12)},H:function(a){return a.getHours()},HH:function(a){return zeroPad(a.getHours())}};fc.applyAll=applyAll;function exclEndDay(a){if(a.end){return _exclEndDay(a.end,a.allDay)}else{return addDays(cloneDate(a.start),1)}}function _exclEndDay(a,b){a=cloneDate(a);return b||a.getHours()||a.getMinutes()?addDays(a,1):clearTime(a)}function segCmp(d,c){return(c.msLength-d.msLength)*100+(d.event.start-c.event.start)}function segsCollide(b,a){return b.end>a.start&&b.start<a.end}function sliceSegs(n,g,c,f){var d=[],h,k=n.length,b,l,j,m,o,a,e;for(h=0;h<k;h++){b=n[h];l=b.start;j=g[h];if(j>c&&l<f){if(l<c){m=cloneDate(c);a=false}else{m=l;a=true}if(j>f){o=cloneDate(f);e=false}else{o=j;e=true}d.push({event:b,start:m,end:o,isStart:a,isEnd:e,msLength:o-m})}}return d.sort(segCmp)}function stackSegs(c){var g=[],f,a=c.length,b,e,h,d;for(f=0;f<a;f++){b=c[f];e=0;while(true){h=false;if(g[e]){for(d=0;d<g[e].length;d++){if(segsCollide(g[e][d],b)){h=true;break}}}if(h){e++}else{break}}if(g[e]){g[e].push(b)}else{g[e]=[b]}}return g}function lazySegBind(b,a,c){b.unbind("mouseover").mouseover(function(h){var g=h.target,j,f,d;while(g!=this){j=g;g=g.parentNode}if((f=j._fci)!==undefined){j._fci=undefined;d=a[f];c(d.event,d.element,d);$(h.target).trigger(h)}h.stopPropagation()})}function setOuterWidth(c,d,a){for(var b=0,f;b<c.length;b++){f=$(c[b]);f.width(Math.max(0,d-hsides(f,a)))}}function setOuterHeight(d,a,b){for(var c=0,f;c<d.length;c++){f=$(d[c]);f.height(Math.max(0,a-vsides(f,b)))}}function hsides(b,a){return hpadding(b)+hborders(b)+(a?hmargins(b):0)}function hpadding(a){return(parseFloat($.curCSS(a[0],"paddingLeft",true))||0)+(parseFloat($.curCSS(a[0],"paddingRight",true))||0)}function hmargins(a){return(parseFloat($.curCSS(a[0],"marginLeft",true))||0)+(parseFloat($.curCSS(a[0],"marginRight",true))||0)}function hborders(a){return(parseFloat($.curCSS(a[0],"borderLeftWidth",true))||0)+(parseFloat($.curCSS(a[0],"borderRightWidth",true))||0)}function vsides(b,a){return vpadding(b)+vborders(b)+(a?vmargins(b):0)}function vpadding(a){return(parseFloat($.curCSS(a[0],"paddingTop",true))||0)+(parseFloat($.curCSS(a[0],"paddingBottom",true))||0)}function vmargins(a){return(parseFloat($.curCSS(a[0],"marginTop",true))||0)+(parseFloat($.curCSS(a[0],"marginBottom",true))||0)}function vborders(a){return(parseFloat($.curCSS(a[0],"borderTopWidth",true))||0)+(parseFloat($.curCSS(a[0],"borderBottomWidth",true))||0)}function setMinHeight(b,a){a=(typeof a=="number"?a+"px":a);b.each(function(d,c){c.style.cssText+=";min-height:"+a+";_height:"+a})}function noop(){}function cmp(d,c){return d-c}function arrayMax(b){return Math.max.apply(Math,b)}function zeroPad(a){return(a<10?"0":"")+a}function smartProperty(e,a){if(e[a]!==undefined){return e[a]}var d=a.split(/(?=[A-Z])/),c=d.length-1,b;for(;c>=0;c--){b=e[d[c].toLowerCase()];if(b!==undefined){return b}}return e[""]}function htmlEscape(a){return a.replace(/&/g,"&amp;").replace(/</g,"&lt;").replace(/>/g,"&gt;").replace(/'/g,"&#039;").replace(/"/g,"&quot;").replace(/\n/g,"<br />")}function cssKey(a){return a.id+"/"+a.className+"/"+a.style.cssText.replace(/(^|;)\s*(top|left|width|height)\s*:[^;]*/ig,"")}function disableTextSelection(a){a.attr("unselectable","on").css("MozUserSelect","none").bind("selectstart.ui",function(){return false})}function markFirstLast(a){a.children().removeClass("fc-first fc-last").filter(":first-child").addClass("fc-first").end().filter(":last-child").addClass("fc-last")}function setDayID(a,b){a.each(function(c,d){d.className=d.className.replace(/^fc-\w*/,"fc-id"+b)})}function getSkinCss(b,c){var a=b.source||{};var h=b.color;var f=a.color;var e=c("eventColor");var i=b.backgroundColor||h||a.backgroundColor||f||c("eventBackgroundColor")||e;var d=b.borderColor||h||a.borderColor||f||c("eventBorderColor")||e;var j=b.textColor||a.textColor||c("eventTextColor");var g=[];if(i){g.push("background-color:"+i)}if(d){g.push("border-color:"+d)}if(j){g.push("color:"+j)}return g.join(";")}function applyAll(d,e,b){if($.isFunction(d)){d=[d]}if(d){var c;var a;for(c=0;c<d.length;c++){a=d[c].apply(e,b)||a}return a}}function firstDefined(){for(var a=0;a<arguments.length;a++){if(arguments[a]!==undefined){return arguments[a]}}}fcViews.resourceDay=ResourceDayView;function ResourceDayView(e,g){var d=this;d.render=f;ResourceView.call(d,e,g,"resourceDay");var c=d.opt;var b=d.renderBasic;var a=g.formatDates;function f(){var k=new Date();var m=addMinutes(cloneDate(k,true),c("minTime")*60);var j=addMinutes(cloneDate(m),(c("maxTime")-c("minTime"))*60);var i=cloneDate(m);var h=cloneDate(j);d.title="";d.start=m;d.end=j;d.visStart=i;d.visEnd=h;var l=Math.round((h-i)/1000/60/c("slotMinutes"));b(c("days").length,c("days").length,l,false)}}setDefaults({weekMode:"fixed"});function ResourceView(r,R,k){var Q=this;Q.renderBasic=J;Q.setHeight=O;Q.setWidth=Y;Q.renderDayOverlay=E;Q.defaultSelectionEnd=D;Q.renderSelection=S;Q.clearSelection=a;Q.reportDayClick=p;Q.dragStart=d;Q.dragStop=l;Q.defaultEventEnd=af;Q.getHoverListener=function(){return e};Q.colContentLeft=N;Q.colContentRight=K;Q.timeOfDayCol=B;Q.dateCell=L;Q.cellDate=ae;Q.cellIsAllDay=function(){return true};Q.allDayRow=o;Q.allDayBounds=V;Q.getRowCnt=function(){return x};Q.getColCnt=function(){return g};Q.getResources=function(){return v("days")};Q.getColWidth=function(){return z};Q.getViewName=function(){return k};Q.getDaySegmentContainer=function(){return n};View.call(Q,r,R,k);OverlayManager.call(Q);SelectionManager.call(Q);ResourceEventRenderer.call(Q);var v=Q.opt;var G=Q.trigger;var C=Q.clearEvents;var ab=Q.renderOverlay;var j=Q.clearOverlays;var M=Q.daySelectionMousedown;var P=R.formatDate;var q;var m;var y;var i;var s;var A;var I;var n;var ac;var ah;var z;var x,g,c;var U;var e;var W;var T,ag,ad;var u;var ai;var h;disableTextSelection(r.addClass("fc-grid"));function J(aj,ak,am,t){x=ak;g=am;Z();var al=!y;if(al||k=="resourceMonth"){F(aj,t)}else{C()}b(al)}function Z(){ag=1;ad=0;ai=v("theme")?"ui":"fc";h=v("columnFormat")}function F(an,ap){var at;var aj=ai+"-widget-header";var ak=ai+"-widget-content";var am,al,t,ao;var ar;var aq=v("days");at="<table class='fc-border-separate' style='width:100%' cellspacing='0'><thead><tr class='fc-first fc-last'><th class='fc-resourceName'>&nbsp;</th>";for(am=0;am<g;am++){at+="<th class='fc- "+aj+"'/>"}at+="</tr></thead><tbody>";for(am=0;am<an;am++){t=aq[am]["id"];ao=aq[am]["name"];at+="<tr class='fc-week"+t+"'><td class='fc-resourceName'>"+ao+"</td>";for(al=0;al<g;al++){at+="<td class='fc- "+ak+" fc-day"+al+" fc-resource"+t+"'><div>"+(ap?"<div class='fc-day-number'/>":"")+"<div class='fc-day-content'><div style='position:relative'>&nbsp;</div></div></div></td>"}at+="</tr>"}at+="</tbody></table>";ar=r.html($(at));q=ar.find("thead");m=q.find("th:not(th.fc-resourceName)");y=ar.find("tbody");i=y.find("tr");s=y.find("td:not(td.fc-resourceName)");A=i.children().filter(":first-child");I=i.eq(0).find("div.fc-day-content div");m.removeClass("fc-first fc-last").filter(":first").addClass("fc-first").end().filter(":last").addClass("fc-last");s.removeClass("fc-first fc-last");i.each(function(){$(this).children("td:not(td.fc-resourceName):first").addClass("fc-first");$(this).children("td:not(td.fc-resourceName):last").addClass("fc-last")});i.eq(0).addClass("fc-first");f(s);n=$("<div style='position:absolute;z-index:8;top:0;left:0'/>").appendTo(r)}function b(an){var al=Q.start.getMonth();var aj=clearTime(new Date());var t;var ak;var am;m.each(function(ao,ap){t=$(ap);ak=H(ao);t.html(P(ak,h));if(ak.getDay()==0||ak.getDay()==6){t.addClass("fc-weekend")}setDayID(t,ao)});s.each(function(ao,ap){t=$(ap);ak=H(ao);if(+ak==+aj){t.addClass(ai+"-state-highlight fc-today")}else{t.removeClass(ai+"-state-highlight fc-today")}t.find("div.fc-day-number").text(ak.getDate());setDayID(t,ao)});i.each(function(ao,ap){am=$(ap);if(ao<x){am.show();if(ao==x-1){am.addClass("fc-last")}else{am.removeClass("fc-last")}}else{am.hide()}})}function O(aj){ah=aj;var am=ah-q.height();var al;var ak;var t;if(v("weekMode")=="variable"){al=ak=Math.floor(am/(x==1?2:6))}else{al=Math.floor(am/x);ak=am-al*(x-1)}A.each(function(an,ao){if(an<x){t=$(ao);setMinHeight(t.find("> div"),(an==x-1?ak:al)-vsides(t))}})}function Y(t){ac=t;ac-=$("th.fc-resourceName").css("width").replace("px","");W.clear();z=Math.floor(ac/g);setOuterWidth(m.slice(0,-1),z)}function f(t){t.click(aa).mousedown(M)}function aa(ak){if(!v("selectable")){var aj=parseInt(this.className.match(/fc\-day(\d+)/)[1]);var t=H(aj);G("dayClick",this,t,true,ak)}}function E(am,ar,ak,ao){if(ak){U.build()}var t=cloneDate(Q.visStart);var an=addDays(cloneDate(t),g);an=addMinutes(cloneDate(t),v("slotMinutes")*g);var al=new Date(Math.max(t,am));var aq=new Date(Math.min(an,ar));if(al<aq){var aj,ap;aj=(al-t)/1000/60/v("slotMinutes");ap=(aq-t)/1000/60/v("slotMinutes");f(X(ao,aj,ao,ap-1))}}function X(al,am,aj,ak){var t=U.rect(al,Math.round(am),aj,Math.round(ak),r);return ab(t,r)}function D(t,aj){return cloneDate(t)}function S(t,al,ak,aj){if(k=="resourceDay"){E(t,addMinutes(cloneDate(al),v("slotMinutes")),true,aj)}else{E(t,addDays(cloneDate(al),1),true,aj)}}function a(){j()}function p(ak,am,al){var t=L(ak);var aj=s[t.row*g+t.col];G("dayClick",aj,ak,am,al)}function d(ak,t,aj){e.start(function(al){j();if(al){X(al.row,al.col,al.row,al.col)}},t)}function l(am,aj,ak){var t=e.stop();j();if(t){var al=ae(t);G("drop",am,al,true,aj,ak)}}function af(t){return cloneDate(t.start)}U=new CoordinateGrid(function(t,al){var ak,am,aj;m.each(function(ao,an){ak=$(an);am=ak.offset().left;if(ao){aj[1]=am}aj=[am];al[ao]=aj});aj[1]=am+ak.outerWidth();i.each(function(ao,an){if(ao<x){ak=$(an);am=ak.offset().top;if(ao){aj[1]=am}aj=[am];t[ao]=aj}});aj[1]=am+ak.outerHeight()});e=new HoverListener(U);W=new HorizontalPositionCache(function(t){return I.eq(t)});function N(t){return W.left(t)}function K(t){return W.right(t)}function L(ak){var aj,ap,ao,aq,t,an,ar,am;if(k=="resourceDay"){aj=B(ak)}else{if(k=="resourceNextWeeks"){ap=ak.getFullYear();ao=ak.getMonth();aq=ak.getDate();for(var al=0;al<g;al++){t=w(al);an=t.getFullYear();ar=t.getMonth();am=t.getDate();if(ap==an&&ao==ar&&aq==am){aj=al;break}}if(typeof aj=="undefined"){aj=al}}else{aj=dayOfWeekCol(ak.getDay())}}return{col:aj}}function ae(t){return w(t.col)}function w(t){if(k=="resourceDay"){return addMinutes(cloneDate(Q.visStart),t*v("slotMinutes"))}else{return addDays(cloneDate(Q.visStart),t*ag+ad)}}function H(t){return w(t%g)}function B(al){var am=al.getHours();var t=al.getMinutes();var aj=v("slotMinutes");var an,ao,aq,ap;for(var ak=0;ak<=60/aj;ak++){an=ak*aj;ao=Math.abs(an-t);if(ao<=aq||ak==0){aq=ao;ap=an}if(ap==60){am++;ap=0}}t=ap;for(var ak=0;ak<g;ak++){if(H(ak).getHours()==am&&H(ak).getMinutes()==t){return ak}}return g}function o(t){return i.eq(t)}function V(t){var aj=parseInt($(q).find("th.fc-resourceName").css("width").replace("px",""));return{left:aj,right:(ac+aj)}}}function ResourceEventRenderer(){var m=this;m.renderEvents=i;m.compileDaySegs=l;m.clearEvents=k;m.bindDaySeg=h;m.resizableResourceEvent=u;DayEventRenderer.call(m);var d=m.opt;var o=m.trigger;var v=m.isEventDraggable;var x=m.isEventResizable;var w=m.reportEvents;var E=m.reportEventClear;var c=m.eventElementHandlers;var B=m.showEvents;var a=m.hideEvents;var r=m.eventDrop;var G=m.getDaySegmentContainer;var D=m.getHoverListener;var j=m.renderDayOverlay;var q=m.clearOverlays;var g=m.getRowCnt;var s=m.getColCnt;var b=m.getResources;var p=m.getViewName;var n=m.renderDaySegs;var f=m.dateCell;var y=m.clearSelection;var z=m.eventEnd;var A=m.renderTempDaySegs;var C=m.compileDaySegs;var e=m.eventResize;function i(H,t){w(H);n(l(H),t)}function k(){E();G().empty()}function l(U){var P=g(),S=s(),T=b(),J=cloneDate(m.visStart),t=addDays(cloneDate(J),S),Q=$.map(U,exclEndDay),O,V,N,I,L,M,H,R=p(),K=[];if(R=="resourceDay"){t=cloneDate(m.visEnd);Q=$.map(U,function(W){return W.end||addDays(W.start,1)})}for(O=0;O<P;O++){H=T[O].id;V=stackSegs(sliceSegs(U,Q,J,t));for(N=0;N<V.length;N++){I=V[N];for(L=0;L<I.length;L++){M=I[L];M.row=O;M.level=N;if(H==M.event.resource){K.push(M)}}}}return K}function h(I,H,t){if(v(I)){F(I,H)}if(t.isEnd&&x(I)){u(I,H,t)}c(I,H)}function F(t,L){var I=D();var J,K,N,H,O,M=p();L.draggable({zIndex:9,delay:50,opacity:d("dragOpacity"),revertDuration:d("dragRevertDuration"),start:function(P,Q){o("eventDragStart",L,t,P,Q);a(t,L);I.start(function(S,R,T,U){L.draggable("option","revert",!S||!T&&!U);q();if(S){N=T*(d("isRTL")?-1:1);O=d("days");H=O[S.row].id;if(M=="resourceDay"){K=U*(d("isRTL")?-1:1)*d("slotMinutes");j(addMinutes(cloneDate(t.start),K),addMinutes(cloneDate(t.end),K),false,S.row)}else{J=U*(d("isRTL")?-1:1);j(addDays(cloneDate(t.start),J),addDays(exclEndDay(t),J),false,S.row)}}else{K=0;J=0;N=0}},P,"drag")},stop:function(P,Q){I.stop();q();o("eventDragStop",L,t,P,Q);if(M=="resourceDay"&&(K||N)){r(this,t,0,K,t.allDay,P,Q,H)}else{if(J||N){r(this,t,J,0,t.allDay,P,Q,H)}else{L.css("filter","");B(t,L)}}}})}function u(I,H,t){var L=d("isRTL");var K=L?"w":"e";var J=H.find("div.ui-resizable-"+K);var M=false;disableTextSelection(H);H.mousedown(function(N){N.preventDefault()}).click(function(N){if(M){N.preventDefault();N.stopImmediatePropagation()}});J.mousedown(function(X){if(X.which!=1){return}M=true;var R=m.getHoverListener();var V=g();var Z=s();var Y=p();var P=L?-1:1;var O=L?Z-1:0;var Q=H.css("top");var S;var W;var N;var U=$.extend({},I);var aa=f(I.start);y();$("body").css("cursor",K+"-resize").one("mouseup",T);o("eventResizeStart",this,I,X);R.start(function(ac,ab){if(ac){var af=Math.max(aa.row,ac.row);var ag=ac.col;if(Y=="resourceDay"){W=(d("slotMinutes")*ag*P+O)-(d("slotMinutes")*ab.col*P+O);var ae=addMinutes(z(I),W,true)}else{S=(7+ag*P+O)-(7+ab.col*P+O);var ae=addDays(z(I),S,true)}if(S||W){U.end=ae;var ad=N;N=A(C([U]),t.row,Q);N.find("*").css("cursor",K+"-resize");if(ad){ad.remove()}a(I)}else{if(N){B(I);N.remove();N=null}}q();if(Y=="resourceDay"){j(I.start,addMinutes(cloneDate(ae),0),1,ab.row)}else{j(I.start,addDays(cloneDate(ae),1),1,ab.row)}}},X);function T(ab){o("eventResizeStop",this,I,ab);$("body").css("cursor","");R.stop();q();if(S){e(this,I,S,0,ab)}else{if(W){e(this,I,0,W,ab)}}setTimeout(function(){M=false},0)}})}}function View(e,l,q){var k=this;k.element=e;k.calendar=l;k.name=q;k.opt=c;k.trigger=m;k.isEventDraggable=p;k.isEventResizable=u;k.reportEvents=r;k.eventEnd=v;k.reportEventElement=s;k.reportEventClear=B;k.eventElementHandlers=b;k.showEvents=y;k.hideEvents=a;k.eventDrop=o;k.eventResize=d;var C=k.defaultEventEnd;var j=l.normalizeEvent;var i=l.reportEventChange;var w={};var A=[];var h={};var f=l.options;function c(E,t){var D=f[E];if(typeof D=="object"){if(E=="days"){return D}else{return smartProperty(D,t||q)}}return D}function m(t,D){return l.trigger.apply(l,[t,D||k].concat(Array.prototype.slice.call(arguments,2),[k]))}function p(t){return x(t)&&!c("disableDragging")}function u(t){return x(t)&&!c("disableResizing")}function x(t){return firstDefined(t.editable,(t.source||{}).editable,c("editable"))}function r(E){w={};var D,t=E.length,F;for(D=0;D<t;D++){F=E[D];if(w[F._id]){w[F._id].push(F)}else{w[F._id]=[F]}}}function v(t){return t.end?cloneDate(t.end):C(t)}function s(D,t){A.push(t);if(h[D._id]){h[D._id].push(t)}else{h[D._id]=[t]}}function B(){A=[];h={}}function b(D,t){t.click(function(E){if(!t.hasClass("ui-draggable-dragging")&&!t.hasClass("ui-resizable-resizing")){return m("eventClick",this,D,E)}}).hover(function(E){m("eventMouseover",this,D,E)},function(E){m("eventMouseout",this,D,E)})}function y(D,t){n(D,t,"show")}function a(D,t){n(D,t,"hide")}function n(F,E,H){var G=h[F._id],D,t=G.length;for(D=0;D<t;D++){if(!E||G[D][0]!=E[0]){G[D][H]()}}}function o(G,D,F,H,L,J,I,E){var K=D.allDay;var t=D._id;z(w[t],F,H,L,E);m("eventDrop",G,D,F,H,L,function(){z(w[t],-F,-H,K);i(t)},J,I,E);i(t)}function d(I,G,D,t,F,H){var E=G._id;g(w[E],D,t);m("eventResize",I,G,D,t,function(){g(w[E],-D,-t);i(E)},F,H);i(E)}function z(G,E,D,I,H){D=D||0;for(var J,t=G.length,F=0;F<t;F++){J=G[F];if(I!==undefined){J.allDay=I}addMinutes(addDays(J.start,E,true),D);if(J.end){J.end=addMinutes(addDays(J.end,E,true),D)}if(J.resource!=H){J.resource=H}j(J,f)}}function g(G,E,D){D=D||0;for(var H,t=G.length,F=0;F<t;F++){H=G[F];H.end=addMinutes(addDays(v(H),E,true),D);j(H,f)}}}function DayEventRenderer(){var G=this;G.renderDaySegs=F;G.resizableDayEvent=z;G.renderTempDaySegs=K;var m=G.opt;var v=G.trigger;var c=G.isEventDraggable;var L=G.isEventResizable;var M=G.eventEnd;var k=G.reportEventElement;var g=G.showEvents;var l=G.hideEvents;var p=G.eventResize;var P=G.getRowCnt;var E=G.getColCnt;var n=G.getColWidth;var i=G.allDayRow;var J=G.allDayBounds;var C=G.colContentLeft;var A=G.colContentRight;var r=G.dayOfWeekCol;var u=G.timeOfDayCol;var B=G.dateCell;var b=G.compileDaySegs;var e=G.getDaySegmentContainer;var s=G.bindDaySeg;var o=G.calendar.formatDates;var w=G.renderDayOverlay;var h=G.clearOverlays;var a=G.clearSelection;var d=G.getViewName;function F(R,Q){var t=e();var X;var W=P();var ac=E();var V=0;var ab;var aa;var Y;var U;var ad=R.length;var T;var Z;var S;t[0].innerHTML=x(R);y(R,t.children());I(R);D(R,t,Q);O(R);f(R);H(R);X=q();for(ab=0;ab<W;ab++){aa=0;Y=[];for(U=0;U<ac;U++){Y[U]=0}while(V<ad&&(T=R[V]).row==ab){Z=arrayMax(Y.slice(T.startCol,T.endCol));T.top=Z;Z+=T.outerHeight;for(S=T.startCol;S<T.endCol;S++){Y[S]=Z}V++}X[ab].height(arrayMax(Y))}N(R,j(X))}function K(S,R,W){var V=$("<div/>");var t;var Q=e();var U;var X=S.length;var T;V[0].innerHTML=x(S);t=V.children();Q.append(t);y(S,t);O(S);f(S);H(S);N(S,j(q()));t=[];for(U=0;U<X;U++){T=S[U].element;if(T){if(S[U].row===R){T.css("top",W)}t.push(T[0])}}return $(t)}function x(U){var Z;var af=U.length;var Y;var S;var T;var W;var t=J();var X=t.left;var R=t.right;var ad;var Q;var V;var ae;var ac;var aa="";var ab=d();for(Z=0;Z<af;Z++){Y=U[Z];S=Y.event;W=["fc-event","fc-event-skin","fc-event-hori"];if(c(S)){W.push("fc-event-draggable")}if(Y.isStart){W.push("fc-corner-left")}if(Y.isEnd){W.push("fc-corner-right")}ad=u(Y.start);Q=u(Y.end)-1;V=Y.isStart?C(ad):X;ae=Y.isEnd?A(Q):R;W=W.concat(S.className);if(S.source){W=W.concat(S.source.className||[])}ac=getSkinCss(S,m);aa+="<div";aa+=" class='"+W.join(" ")+"' style='position:absolute;z-index:8;left:"+V+"px;"+ac+"'><div class='fc-event-inner fc-event-skin'"+(ac?" style='"+ac+"'":"")+">";aa+="<span class='fc-event-time'>"+htmlEscape(o(S.start,S.end,m("timeFormat")))+"</span>";aa+="<span class='fc-event-title' "+(ac?" style='"+ac+"'":"")+">"+htmlEscape(S.title)+"</span>";aa+="<span class='fc-end-event-time'>"+htmlEscape(o(S.end,S.end,m("timeFormat")))+"</span>";aa+="</div>";if(Y.isEnd&&L(S)){aa+="<div class='ui-resizable-handle ui-resizable-e'>&nbsp;&nbsp;&nbsp;</div>"}aa+="</"+(T?"a":"div")+">";Y.left=V;Y.outerWidth=ae-V;Y.startCol=ad;Y.endCol=Q+1}return aa}function y(Q,V){var T;var W=Q.length;var t;var U;var S;var R;for(T=0;T<W;T++){t=Q[T];U=t.event;S=$(V[T]);R=v("eventRender",U,U,S);if(R===false){S.remove()}else{if(R&&R!==true){R=$(R).css({position:"absolute",left:t.left});S.replaceWith(R);S=R}t.element=S}}}function I(Q){var S;var T=Q.length;var t;var R;for(S=0;S<T;S++){t=Q[S];R=t.element;if(R){k(t.event,R)}}}function D(Q,V,R){var T;var W=Q.length;var t;var S;var U;for(T=0;T<W;T++){t=Q[T];S=t.element;if(S){U=t.event;if(U._id===R){s(U,S,t)}else{S[0]._fci=T}}}lazySegBind(V,Q,s)}function O(Q){var U;var V=Q.length;var t;var T;var S,W;var R={};for(U=0;U<V;U++){t=Q[U];T=t.element;if(T){S=t.key=cssKey(T[0]);W=R[S];if(W===undefined){W=R[S]=hsides(T,true)}t.hsides=W}}}function f(Q){var S;var T=Q.length;var t;var R;for(S=0;S<T;S++){t=Q[S];R=t.element;if(R){R[0].style.width=Math.max(0,t.outerWidth-t.hsides)+"px"}}}function H(Q){var T;var V=Q.length;var t;var S;var R,W;var U={};for(T=0;T<V;T++){t=Q[T];S=t.element;if(S){R=t.key;W=U[R];if(W===undefined){W=U[R]=vmargins(S)}t.outerHeight=S[0].offsetHeight+W}}}function q(){var t;var R=P();var Q=[];for(t=0;t<R;t++){Q[t]=i(t).find("td:not(.fc-resourceName):first div.fc-day-content > div")}return Q}function j(Q){var t;var S=Q.length;var R=[];for(t=0;t<S;t++){R[t]=Q[t][0].offsetTop}return R}function N(Q,V){var S;var U=Q.length;var t;var R;var T;for(S=0;S<U;S++){t=Q[S];R=t.element;if(R){R[0].style.top=V[t.row]+(t.top||0)+"px";T=t.event;v("eventAfterRender",T,T,R)}}}function z(R,Q,t){var T=rtl?"w":"e";var S=Q.find("div.ui-resizable-"+T);var U=false;disableTextSelection(Q);Q.mousedown(function(V){V.preventDefault()}).click(function(V){if(U){V.preventDefault();V.stopImmediatePropagation()}});S.mousedown(function(ae){if(ae.which!=1){return}U=true;var Z=G.getHoverListener();var ad=P();var af=E();var X=rtl?-1:1;var W=rtl?af-1:0;var Y=Q.css("top");var aa;var V;var ac=$.extend({},R);var ag=B(R.start);a();$("body").css("cursor",T+"-resize").one("mouseup",ab);v("eventResizeStart",this,R,ae);Z.start(function(ai,ah){if(ai){var al=Math.max(ag.row,ai.row);var am=ai.col;if(ad==1){al=0}if(al==ag.row){if(rtl){am=Math.min(ag.col,am)}else{am=Math.max(ag.col,am)}}aa=(al*7+am*X+W)-(ah.row*7+ah.col*X+W);var ak=addDays(M(R),aa,true);if(aa){ac.end=ak;var aj=V;V=K(b([ac]),t.row,Y);V.find("*").css("cursor",T+"-resize");if(aj){aj.remove()}l(R)}else{if(V){g(R);V.remove();V=null}}h();w(R.start,addDays(cloneDate(ak),1))}},ae);function ab(ah){v("eventResizeStop",this,R,ah);$("body").css("cursor","");Z.stop();h();if(aa){p(this,R,aa,0,ah)}setTimeout(function(){U=false},0)}})}}function SelectionManager(){var l=this;l.select=j;l.unselect=f;l.reportSelection=a;l.daySelectionMousedown=i;var c=l.opt;var d=l.trigger;var g=l.defaultSelectionEnd;var b=l.renderSelection;var k=l.clearSelection;var e=l.getViewName;var h=false;if(c("selectable")&&c("unselectAuto")){$(document).mousedown(function(m){var n=c("unselectCancel");if(n){if($(m.target).parents(n).length){return}}f(m)})}function j(m,o,n){f();if(!o){o=g(m,n)}b(m,o,n);a(m,o,n)}function f(m){if(h){h=false;k();d("unselect",null,m)}}function a(m,q,p,n,o){h=true;d("select",null,m,q,p,n,"",o)}function i(r){var p=l.cellDate;var s=l.cellIsAllDay;var o=l.getHoverListener();var q=l.reportDayClick;var v;var u=c("days");var t=e();if(r.which==1&&c("selectable")){f(r);var n=this;var m;o.start(function(x,w){k();if(x&&s(x)){m=[p(w),p(x)].sort(cmp);b(m[0],m[1],(t=="resourceDay"?false:true),x.row);v=x.row}else{m=null}},r);$(document).one("mouseup",function(w){o.stop();if(m){if(+m[0]==+m[1]){q(m[0],(t=="resourceDay"?false:true),w)}a(m[0],(t=="resourceDay"?addMinutes(m[1],c("slotMinutes")):m[1]),(t=="resourceDay"?false:true),w,u[v])}})}}}function OverlayManager(){var d=this;d.renderOverlay=b;d.clearOverlays=a;var c=[];var e=[];function b(g,f){var h=e.shift();if(!h){h=$("<div class='fc-cell-overlay' style='position:absolute;z-index:3'/>")}if(h[0].parentNode!=f[0]){h.appendTo(f)}c.push(h.css(g).show());return h}function a(){var f;while(f=c.shift()){e.push(f.hide().unbind())}}}function CoordinateGrid(a){var b=this;var c;var d;b.build=function(){c=[];d=[];a(c,d)};b.cell=function(e,l){var k=c.length;var f=d.length;var g,h=-1,j=-1;for(g=0;g<k;g++){if(l>=c[g][0]&&l<c[g][1]){h=g;break}}for(g=0;g<f;g++){if(e>=d[g][0]&&e<d[g][1]){j=g;break}}return(h>=0&&j>=0)?{row:h,col:j}:null};b.rect=function(h,j,f,g,i){var e=i.offset();return{top:c[h][0]-e.top,left:d[j][0]-e.left,width:d[g][1]-d[j][0],height:c[f][1]-c[h][0]}}}function HoverListener(f){var d=this;var e;var g;var b;var a;d.start=function(h,i,j){g=h;b=a=null;f.build();c(i);e=j||"mousemove";$(document).bind(e,c)};function c(h){var i=f.cell(h.pageX,h.pageY);if(!i!=!a||i&&(i.row!=a.row||i.col!=a.col)){if(i){if(!b){b=i}g(i,b,i.row-b.row,i.col-b.col)}else{g(i,b)}a=i}}d.stop=function(){$(document).unbind(e,c);return a}}function HorizontalPositionCache(b){var a=this,c={},g={},f={};function d(e){return c[e]=c[e]||b(e)}a.left=function(e){return g[e]=g[e]===undefined?d(e).position().left:g[e]};a.right=function(e){return f[e]=f[e]===undefined?a.left(e)+d(e).width():f[e]};a.clear=function(){c={};g={};f={}}};